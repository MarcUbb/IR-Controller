\hypertarget{main_8h}{}\doxysection{include/main.h File Reference}
\label{main_8h}\index{include/main.h@{include/main.h}}


Header File for \mbox{\hyperlink{main_8cpp}{main.\+cpp}}.  


{\ttfamily \#include $<$Wi\+Fi\+Manager.\+h$>$}\newline
{\ttfamily \#include $<$E\+S\+P8266\+Web\+Server.\+h$>$}\newline
{\ttfamily \#include $<$E\+S\+P8266m\+D\+N\+S.\+h$>$}\newline
{\ttfamily \#include \char`\"{}workflows.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}website\+\_\+string.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}tests.\+h\char`\"{}}\newline
Include dependency graph for main.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=169pt]{main_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8h_a91f7b87e7f7bfe06d679424d3972d949}{handle\+\_\+root}} ()
\begin{DoxyCompactList}\small\item\em Handler function for the root page. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_abbb2c8533d3382aff50c25132e42be24}{handle\+\_\+not\+\_\+found}} ()
\begin{DoxyCompactList}\small\item\em Handler function for any page that is not found. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_aad3360fdec17398d0e5302151e4805a6}{handle\+\_\+program}} ()
\begin{DoxyCompactList}\small\item\em Handler function to display the program the user wants to edit. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a3c215e38d85a8d3c7e6dcc57b9581784}{handle\+\_\+error}} ()
\begin{DoxyCompactList}\small\item\em Handler function to display the error message. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_af34fc8222bc1516385d025f1c386783b}{handle\+\_\+files}} ()
\begin{DoxyCompactList}\small\item\em Handler function to send a list of all signals and programs to the forntend. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a804df23af2d5325f6b80505441c440c0}{handle\+\_\+time}} ()
\begin{DoxyCompactList}\small\item\em Handler funciton to synchronize the time and/or timezone provided by the user. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_af5c95b85845a3f351230b178b26965cc}{handle\+\_\+credentials}} ()
\begin{DoxyCompactList}\small\item\em Handler function to erase the wifi credentials saved on the E\+SP. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a8a124067f0737e535090ebb8b87fe225}{handle\+\_\+apmode}} ()
\begin{DoxyCompactList}\small\item\em Handler function to switch between AP mode and normal mode. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_af19e4342307c909a6199729eca7749d7}{handle\+\_\+apinfo}} ()
\begin{DoxyCompactList}\small\item\em Handler function to send the current AP mode setting to the frontend. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a4396215f1508823a1e88adf1f2ee7314}{handle\+\_\+password}} ()
\begin{DoxyCompactList}\small\item\em Handler function that receives new password entries. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_ab2a21540700dc92473c6acd2eaf11720}{handle\+\_\+form}} ()
\begin{DoxyCompactList}\small\item\em Handler function that receives G\+ET requests from all form elements related to signals and programs. \end{DoxyCompactList}\item 
E\+S\+P8266\+Web\+Server \mbox{\hyperlink{main_8h_a58141c4f251beaa1fee89b632d87152f}{server}} (80)
\begin{DoxyCompactList}\small\item\em Constructor of the webserver that is used to serve the website. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
String \mbox{\hyperlink{main_8h_abe41ecb0252482a8b08c12fd7c075ad0}{P\+R\+O\+G\+R\+A\+M\+N\+A\+ME}} = \char`\"{}\char`\"{}
\begin{DoxyCompactList}\small\item\em Holds the name of the currently selected program if the edit button was pressed. Gets updated on /form and called on /program. \end{DoxyCompactList}\item 
String \mbox{\hyperlink{main_8h_a603139e4d1154d5e88892633712d0d78}{M\+E\+S\+S\+A\+GE}} = \char`\"{}\char`\"{}
\begin{DoxyCompactList}\small\item\em Holds the message that is displayed on the website and updated on reload. \end{DoxyCompactList}\item 
boolean \mbox{\hyperlink{main_8h_a3fff6f849e5ef46091ccba2137f2b0ab}{S\+E\+S\+S\+I\+O\+N\+\_\+\+AP}} = true
\begin{DoxyCompactList}\small\item\em Stores the session value (if A\+P-\/\+Mode is activated or not). \end{DoxyCompactList}\item 
boolean \mbox{\hyperlink{main_8h_a0bec7efe2c40139aec61488b06e17494}{A\+P\+\_\+\+S\+E\+T\+T\+I\+NG}} = true
\begin{DoxyCompactList}\small\item\em Tracks which setting to be used on reboot. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Header File for \mbox{\hyperlink{main_8cpp}{main.\+cpp}}. 

\begin{DoxyAuthor}{Author}
Marc Ubbelohde
\end{DoxyAuthor}
This file includes dependencies for the wifi setup and webserver. Also the H\+T\+ML code for the website is included and the variables that are shared between the handler functions are declared. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{main_8h_af19e4342307c909a6199729eca7749d7}\label{main_8h_af19e4342307c909a6199729eca7749d7}} 
\index{main.h@{main.h}!handle\_apinfo@{handle\_apinfo}}
\index{handle\_apinfo@{handle\_apinfo}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_apinfo()}{handle\_apinfo()}}
{\footnotesize\ttfamily void handle\+\_\+apinfo (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to send the current AP mode setting to the frontend. 

Sends the current AP mode setting to the frontend. This is used to display the correct setting at the top the website.

This function is called on a G\+ET request to /apinfo. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=249pt]{main_8h_af19e4342307c909a6199729eca7749d7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{main_8h_af19e4342307c909a6199729eca7749d7_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a8a124067f0737e535090ebb8b87fe225}\label{main_8h_a8a124067f0737e535090ebb8b87fe225}} 
\index{main.h@{main.h}!handle\_apmode@{handle\_apmode}}
\index{handle\_apmode@{handle\_apmode}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_apmode()}{handle\_apmode()}}
{\footnotesize\ttfamily void handle\+\_\+apmode (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to switch between AP mode and normal mode. 

Checks the config file and switches between AP mode and normal mode. The possibel reconfiguration of the wifi credentails is done after restart.

This function is called on a G\+ET request to /apmode. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{main_8h_a8a124067f0737e535090ebb8b87fe225_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=255pt]{main_8h_a8a124067f0737e535090ebb8b87fe225_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_af5c95b85845a3f351230b178b26965cc}\label{main_8h_af5c95b85845a3f351230b178b26965cc}} 
\index{main.h@{main.h}!handle\_credentials@{handle\_credentials}}
\index{handle\_credentials@{handle\_credentials}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_credentials()}{handle\_credentials()}}
{\footnotesize\ttfamily void handle\+\_\+credentials (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to erase the wifi credentials saved on the E\+SP. 

Erases the wifi credentials saved on the E\+SP. This is useful if the user wants to connect to a different wifi network.

This function is called on a G\+ET request to /credentials. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=272pt]{main_8h_af5c95b85845a3f351230b178b26965cc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=269pt]{main_8h_af5c95b85845a3f351230b178b26965cc_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a3c215e38d85a8d3c7e6dcc57b9581784}\label{main_8h_a3c215e38d85a8d3c7e6dcc57b9581784}} 
\index{main.h@{main.h}!handle\_error@{handle\_error}}
\index{handle\_error@{handle\_error}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_error()}{handle\_error()}}
{\footnotesize\ttfamily void handle\+\_\+error (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to display the error message. 

Similarly to \mbox{\hyperlink{main_8cpp_aad3360fdec17398d0e5302151e4805a6}{handle\+\_\+program()}}, the website will send a get request on /error to update the error message on reload. The M\+E\+S\+S\+A\+GE is then written again by \mbox{\hyperlink{main_8cpp_ab2a21540700dc92473c6acd2eaf11720}{handle\+\_\+form()}}.

This function is called on a G\+ET request to /error. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=241pt]{main_8h_a3c215e38d85a8d3c7e6dcc57b9581784_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=238pt]{main_8h_a3c215e38d85a8d3c7e6dcc57b9581784_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_af34fc8222bc1516385d025f1c386783b}\label{main_8h_af34fc8222bc1516385d025f1c386783b}} 
\index{main.h@{main.h}!handle\_files@{handle\_files}}
\index{handle\_files@{handle\_files}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_files()}{handle\_files()}}
{\footnotesize\ttfamily void handle\+\_\+files (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to send a list of all signals and programs to the forntend. 

Sends a list of all files in /signals and /programs on reload to be displayed on the website.

This function is called on a G\+ET request to /files. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=251pt]{main_8h_af34fc8222bc1516385d025f1c386783b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=236pt]{main_8h_af34fc8222bc1516385d025f1c386783b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_ab2a21540700dc92473c6acd2eaf11720}\label{main_8h_ab2a21540700dc92473c6acd2eaf11720}} 
\index{main.h@{main.h}!handle\_form@{handle\_form}}
\index{handle\_form@{handle\_form}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_form()}{handle\_form()}}
{\footnotesize\ttfamily void handle\+\_\+form (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function that receives G\+ET requests from all form elements related to signals and programs. 

Handles all form elements on the website (signals and programs) also updates the error message and P\+R\+O\+G\+R\+A\+M\+N\+A\+ME. All the user interaction with the website is handled here and the functions from \mbox{\hyperlink{workflows_8h}{workflows.\+h}} are called.

This function is called on a G\+ET request to /form. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_ab2a21540700dc92473c6acd2eaf11720_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=238pt]{main_8h_ab2a21540700dc92473c6acd2eaf11720_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_abbb2c8533d3382aff50c25132e42be24}\label{main_8h_abbb2c8533d3382aff50c25132e42be24}} 
\index{main.h@{main.h}!handle\_not\_found@{handle\_not\_found}}
\index{handle\_not\_found@{handle\_not\_found}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_not\_found()}{handle\_not\_found()}}
{\footnotesize\ttfamily void handle\+\_\+not\+\_\+found (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function for any page that is not found. 

This function is called when a page is requested that is not found. It serves a 404 error to the client.

This function is called on a G\+ET request to a page that is not found. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{main_8h_abbb2c8533d3382aff50c25132e42be24_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=264pt]{main_8h_abbb2c8533d3382aff50c25132e42be24_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a4396215f1508823a1e88adf1f2ee7314}\label{main_8h_a4396215f1508823a1e88adf1f2ee7314}} 
\index{main.h@{main.h}!handle\_password@{handle\_password}}
\index{handle\_password@{handle\_password}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_password()}{handle\_password()}}
{\footnotesize\ttfamily void handle\+\_\+password (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function that receives new password entries. 

Receives new password entries from frontend and changes password if entries are the same (to prevent typos).

This function is called on a G\+ET request to /password. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=264pt]{main_8h_a4396215f1508823a1e88adf1f2ee7314_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=261pt]{main_8h_a4396215f1508823a1e88adf1f2ee7314_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_aad3360fdec17398d0e5302151e4805a6}\label{main_8h_aad3360fdec17398d0e5302151e4805a6}} 
\index{main.h@{main.h}!handle\_program@{handle\_program}}
\index{handle\_program@{handle\_program}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_program()}{handle\_program()}}
{\footnotesize\ttfamily void handle\+\_\+program (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function to display the program the user wants to edit. 

This function is called when the user wants to edit a program. It reads the program from the file system and sends it back to the website. The website is designed with form elements that trigger forwarding to /form. This is a problem because we can only communicate on that channel and we already have to communicate a back to the website to update the page. So in order to still be able to send data back to the website, on every reload the website will send a get request on /program which triggers this function. The data that is sent back is the name of the currently selected program and the code of that program. It is only sent back if the \char`\"{}edit\char`\"{} button was pressed. (if not, the variables \char`\"{}\+P\+R\+O\+G\+R\+A\+M\+N\+A\+M\+E\char`\"{} and \char`\"{}\+P\+R\+O\+G\+R\+A\+M\+C\+O\+D\+E\char`\"{} will be empty)

This function is called on a G\+ET request to /program. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_aad3360fdec17398d0e5302151e4805a6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{main_8h_aad3360fdec17398d0e5302151e4805a6_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a91f7b87e7f7bfe06d679424d3972d949}\label{main_8h_a91f7b87e7f7bfe06d679424d3972d949}} 
\index{main.h@{main.h}!handle\_root@{handle\_root}}
\index{handle\_root@{handle\_root}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_root()}{handle\_root()}}
{\footnotesize\ttfamily void handle\+\_\+root (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler function for the root page. 

This function is called when the root page is requested. It serves the content of the index\+\_\+html string from the \mbox{\hyperlink{website__string_8h}{website\+\_\+string.\+h}} file to the client.

This function is called on a G\+ET request to the root page. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=237pt]{main_8h_a91f7b87e7f7bfe06d679424d3972d949_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{main_8h_a91f7b87e7f7bfe06d679424d3972d949_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a804df23af2d5325f6b80505441c440c0}\label{main_8h_a804df23af2d5325f6b80505441c440c0}} 
\index{main.h@{main.h}!handle\_time@{handle\_time}}
\index{handle\_time@{handle\_time}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{handle\_time()}{handle\_time()}}
{\footnotesize\ttfamily void handle\+\_\+time (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Handler funciton to synchronize the time and/or timezone provided by the user. 

Gets the time from the client via Date() and saves it together with the millis() offset to the Little\+FS. The offset is important because only with millis() we can calculate the time that has passed between the synchronisation and the time of program execution. This enabled the E\+SP to execute timed programs even if the wifi connection is lost.

This function is called on a G\+ET request to /time. Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_a804df23af2d5325f6b80505441c440c0_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=237pt]{main_8h_a804df23af2d5325f6b80505441c440c0_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a58141c4f251beaa1fee89b632d87152f}\label{main_8h_a58141c4f251beaa1fee89b632d87152f}} 
\index{main.h@{main.h}!server@{server}}
\index{server@{server}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{server()}{server()}}
{\footnotesize\ttfamily E\+S\+P8266\+Web\+Server server (\begin{DoxyParamCaption}\item[{80}]{ }\end{DoxyParamCaption})}



Constructor of the webserver that is used to serve the website. 



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{main_8h_a0bec7efe2c40139aec61488b06e17494}\label{main_8h_a0bec7efe2c40139aec61488b06e17494}} 
\index{main.h@{main.h}!AP\_SETTING@{AP\_SETTING}}
\index{AP\_SETTING@{AP\_SETTING}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{AP\_SETTING}{AP\_SETTING}}
{\footnotesize\ttfamily boolean A\+P\+\_\+\+S\+E\+T\+T\+I\+NG = true}



Tracks which setting to be used on reboot. 

\mbox{\Hypertarget{main_8h_a603139e4d1154d5e88892633712d0d78}\label{main_8h_a603139e4d1154d5e88892633712d0d78}} 
\index{main.h@{main.h}!MESSAGE@{MESSAGE}}
\index{MESSAGE@{MESSAGE}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{MESSAGE}{MESSAGE}}
{\footnotesize\ttfamily String M\+E\+S\+S\+A\+GE = \char`\"{}\char`\"{}}



Holds the message that is displayed on the website and updated on reload. 

\mbox{\Hypertarget{main_8h_abe41ecb0252482a8b08c12fd7c075ad0}\label{main_8h_abe41ecb0252482a8b08c12fd7c075ad0}} 
\index{main.h@{main.h}!PROGRAMNAME@{PROGRAMNAME}}
\index{PROGRAMNAME@{PROGRAMNAME}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{PROGRAMNAME}{PROGRAMNAME}}
{\footnotesize\ttfamily String P\+R\+O\+G\+R\+A\+M\+N\+A\+ME = \char`\"{}\char`\"{}}



Holds the name of the currently selected program if the edit button was pressed. Gets updated on /form and called on /program. 

\mbox{\Hypertarget{main_8h_a3fff6f849e5ef46091ccba2137f2b0ab}\label{main_8h_a3fff6f849e5ef46091ccba2137f2b0ab}} 
\index{main.h@{main.h}!SESSION\_AP@{SESSION\_AP}}
\index{SESSION\_AP@{SESSION\_AP}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{SESSION\_AP}{SESSION\_AP}}
{\footnotesize\ttfamily boolean S\+E\+S\+S\+I\+O\+N\+\_\+\+AP = true}



Stores the session value (if A\+P-\/\+Mode is activated or not). 

